<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="900" viewBox="0 0 1000 900">
  <style>
    .bg { fill: #0f1724; }
    .title { fill: #e6edf3; font-family: Arial, sans-serif; font-size: 28px; font-weight: 700; }
    .subtitle { fill: #a8d0ff; font-family: Arial, sans-serif; font-size: 16px; font-weight: 600; }
    .label { fill: #cbd6e9; font-family: Arial, sans-serif; font-size: 14px; }
    .desc { fill: #9fb3d6; font-family: Arial, sans-serif; font-size: 12px; }
    .method-box { stroke: #58a6ff; stroke-width: 2; fill: #0b1220; rx: 6; }
    .arrow { stroke: #79c0ff; stroke-width: 3; fill: none; marker-end: url(#arrowhead); }
    .exception-box { fill: #ff922b; stroke: #ffa94d; stroke-width: 2; rx: 6; }
    .caught-box { fill: #238636; stroke: #3fb950; stroke-width: 2; rx: 6; }
    .uncaught-box { fill: #da3633; stroke: #f85149; stroke-width: 2; rx: 6; }
    .code { fill: #79c0ff; font-family: monospace; font-size: 12px; }
  </style>

  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#79c0ff" />
    </marker>
  </defs>

  <rect class="bg" x="0" y="0" width="1000" height="900" />

  <!-- Title -->
  <text class="title" x="50" y="40">Exception Propagation Flow üì§</text>
  <text class="subtitle" x="50" y="65">How exceptions bubble up the call stack</text>

  <!-- Call Stack Visualization -->
  <g transform="translate(50, 100)">
    <!-- main() -->
    <rect class="method-box" x="0" y="0" width="200" height="60" />
    <text class="label" x="100" y="20" text-anchor="middle" font-weight="700">main()</text>
    <text class="desc" x="100" y="38" text-anchor="middle">Entry point</text>

    <!-- Arrow down -->
    <path class="arrow" d="M 100 60 L 100 100" />
    <text class="code" x="110" y="85">calls</text>

    <!-- methodA() -->
    <rect class="method-box" x="0" y="100" width="200" height="60" />
    <text class="label" x="100" y="120" text-anchor="middle" font-weight="700">methodA()</text>
    <text class="desc" x="100" y="138" text-anchor="middle">No handler</text>

    <!-- Arrow down -->
    <path class="arrow" d="M 100 160 L 100 200" />
    <text class="code" x="110" y="185">calls</text>

    <!-- methodB() -->
    <rect class="method-box" x="0" y="200" width="200" height="60" />
    <text class="label" x="100" y="220" text-anchor="middle" font-weight="700">methodB()</text>
    <text class="desc" x="100" y="238" text-anchor="middle">No handler</text>

    <!-- Arrow down -->
    <path class="arrow" d="M 100 260 L 100 300" />
    <text class="code" x="110" y="285">calls</text>

    <!-- methodC() ‚Äî Exception Thrown -->
    <rect class="method-box" x="0" y="300" width="200" height="60" />
    <text class="label" x="100" y="320" text-anchor="middle" font-weight="700">methodC()</text>
    <text class="desc" x="100" y="338" text-anchor="middle">üî¥ Throws Exception</text>

    <!-- Exception Box -->
    <rect class="exception-box" x="250" y="315" width="180" height="45" />
    <text class="label" x="340" y="335" text-anchor="middle">IOException thrown!</text>

    <!-- Arrow up through stack -->
    <path class="arrow" d="M 100 300 L 100 260 L 100 200 L 100 160" stroke="#ff922b" />

    <!-- Caught at methodA() -->
    <rect class="caught-box" x="250" y="220" width="240" height="60" />
    <text class="label" x="370" y="240" text-anchor="middle" fill="#fff" font-weight="700">‚úÖ CAUGHT HERE</text>
    <text class="code" x="270" y="260" font-size="11">catch (IOException e) { ... }</text>

    <!-- Stop marker -->
    <text class="label" x="100" y="410" text-anchor="middle" font-size="16">Exception stops propagating</text>
    <text class="desc" x="100" y="430" text-anchor="middle">Program continues with recovery</text>
  </g>

  <!-- Scenario 2: Uncaught Exception -->
  <g transform="translate(550, 100)">
    <text class="subtitle" x="0" y="0">Scenario: NO Catch Block</text>

    <!-- Simplified stack -->
    <rect class="method-box" x="0" y="30" width="190" height="50" />
    <text class="code" x="95" y="50" text-anchor="middle" font-size="12">main()</text>

    <path class="arrow" d="M 95 80 L 95 110" />

    <rect class="method-box" x="0" y="110" width="190" height="50" />
    <text class="code" x="95" y="130" text-anchor="middle" font-size="12">methodA()</text>

    <path class="arrow" d="M 95 160 L 95 190" />

    <rect class="method-box" x="0" y="190" width="190" height="50" />
    <text class="code" x="95" y="210" text-anchor="middle" font-size="12">methodB()</text>

    <!-- Exception propagates all the way -->
    <path class="arrow" d="M 95 240 L 95 300" stroke="#ff922b" stroke-dasharray="5,5" />
    <text class="label" x="200" y="270" fill="#ff922b" font-weight="700">Propagates</text>

    <!-- Uncaught at top -->
    <rect class="uncaught-box" x="0" y="300" width="190" height="60" />
    <text class="label" x="95" y="320" text-anchor="middle" fill="#fff" font-weight="700">‚ùå UNCAUGHT</text>
    <text class="desc" x="95" y="340" text-anchor="middle" fill="#fff" font-size="11">Thread dies</text>

    <text class="desc" x="0" y="400" font-size="12">Result: Stack trace printed,</text>
    <text class="desc" x="0" y="420" font-size="12">thread termination, program</text>
    <text class="desc" x="0" y="440" font-size="12">may crash if main thread.</text>
  </g>

  <!-- Best Practices -->
  <g transform="translate(50, 600)">
    <text class="subtitle" x="0" y="0">üéØ Best Practices for Exception Handling</text>

    <rect x="0" y="20" width="900" height="240" fill="#1f2937" stroke="#58a6ff" stroke-width="2" rx="6" />

    <g transform="translate(20, 35)">
      <text class="label" x="0" y="0" font-weight="700">1Ô∏è‚É£ Catch Specific Exceptions</text>
      <text class="code" x="0" y="20">‚ùå catch (Exception e)         // Too broad!</text>
      <text class="code" x="0" y="38">‚úÖ catch (IOException e)      // Specific!</text>

      <text class="label" x="0" y="70" font-weight="700">2Ô∏è‚É£ Use Try-with-Resources</text>
      <text class="code" x="0" y="90">try (BufferedReader r = new BufferedReader(...)) {</text>
      <text class="code" x="0" y="108">  // Auto-closes regardless of exception</text>
      <text class="code" x="0" y="126">}</text>

      <text class="label" x="0" y="158" font-weight="700">3Ô∏è‚É£ Use throws When Caller Should Decide</text>
      <text class="code" x="0" y="178">void readFile(String path) throws IOException {</text>
      <text class="code" x="0" y="196">  // Caller chooses to handle or pass up</text>
      <text class="code" x="0" y="214">}</text>
    </g>
  </g>

  <!-- Interview Tip -->
  <g transform="translate(50, 880)">
    <text class="desc" x="0" y="0">üí° Interview: Explain the flow: "Exception is thrown ‚Üí checked through stack ‚Üí caught or thread dies."</text>
  </g>
</svg>